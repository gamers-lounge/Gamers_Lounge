this["wc-bookings-availability"]=this["wc-bookings-availability"]||{},this["wc-bookings-availability"]["bookings-availability-common"]=function(t){var e={};function r(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=80)}({13:function(t,e){!function(){t.exports=this.lodash}()},15:function(t,e,r){var n=r(6);t.exports=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),a.forEach(function(e){n(t,e,r[e])})}return t}},17:function(t,e,r){"use strict";r.d(e,"b",function(){return c}),r.d(e,"e",function(){return u}),r.d(e,"a",function(){return s}),r.d(e,"d",function(){return d}),r.d(e,"c",function(){return f});var n=r(15),a=r.n(n),o=r(2),i=r(7),c={ALL_PRODUCTS:"all-products",PRODUCTS_SCREEN:"products-screen",CATEGORIES_SCREEN:"categories-screen",RESOURCES_SCREEN:"resources-screen"},u=[{value:c.ALL_PRODUCTS,label:Object(o.__)("All bookable products","woocommerce-bookings-availability")},{value:c.PRODUCTS_SCREEN,label:Object(o.__)("Specific bookable products","woocommerce-bookings-availability")},{value:c.CATEGORIES_SCREEN,label:Object(o.__)("Specific categories","woocommerce-bookings-availability")},{value:c.RESOURCES_SCREEN,label:Object(o.__)("Specific resources","woocommerce-bookings-availability")}],s=8,l={common:{categoryIds:{type:"string",default:"",source:"attribute",selector:".wc-bookings-availability-main-container",attribute:"data-category-ids"},currentScreen:{type:"string",default:""},productIds:{type:"string",default:"",source:"attribute",selector:".wc-bookings-availability-main-container",attribute:"data-product-ids"},resourceIds:{type:"string",default:"",source:"attribute",selector:".wc-bookings-availability-main-container",attribute:"data-resource-ids"},showDateNav:{type:"boolean",default:!0,attribute:"data-show-date-nav"}},calendar:{dateRangeType:{type:"string",default:i.b.THIS_MONTH,attribute:"data-date-range-type"},showSoldOut:{type:"boolean",default:!0,attribute:"data-show-sold-out"}},schedule:{dateRangeType:{type:"string",default:i.b.TODAY,attribute:"data-date-range-type"},infiniteScrollEnabled:{type:"boolean",default:!0,attribute:"data-infinite-scroll-enabled"},maxDate:{type:"date",default:null,source:"attribute",selector:".wc-bookings-availability-container",attribute:"data-max-date"},minDate:{type:"date",default:null,source:"attribute",selector:".wc-bookings-availability-container",attribute:"data-min-date"},slotsPerPage:{type:"number",default:s,attribute:"data-slots-per-page"}}};function d(t){return a()({},l.common,l[t])}function f(t,e){for(var r=d(t),n={},a=Object.keys(e),o=0;o<a.length;o++){var i=a[o];switch(r[i].type){case"boolean":n[i]="true"===e[i];break;case"number":n[i]=parseInt(e[i]);break;default:n[i]=e[i]}}return n}},19:function(t,e){!function(){t.exports=this.wp.data}()},2:function(t,e){!function(){t.exports=this.wp.i18n}()},20:function(t,e){!function(){t.exports=this.wp.apiFetch}()},24:function(t,e,r){var n=r(43),a=r(44),o=r(45);t.exports=function(t){return n(t)||a(t)||o()}},26:function(t,e){!function(){t.exports=this.wp.url}()},3:function(t,e){!function(){t.exports=this.moment}()},30:function(t,e){!function(){t.exports=this["moment-timezone"]}()},43:function(t,e){t.exports=function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}},44:function(t,e){t.exports=function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}},45:function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},6:function(t,e){t.exports=function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}},7:function(t,e,r){"use strict";r.d(e,"b",function(){return i}),r.d(e,"a",function(){return c}),r.d(e,"c",function(){return s}),r.d(e,"d",function(){return l}),r.d(e,"p",function(){return b}),r.d(e,"o",function(){return m}),r.d(e,"j",function(){return _}),r.d(e,"i",function(){return v}),r.d(e,"f",function(){return y}),r.d(e,"k",function(){return g}),r.d(e,"h",function(){return p}),r.d(e,"m",function(){return O}),r.d(e,"g",function(){return h}),r.d(e,"n",function(){return T}),r.d(e,"l",function(){return E}),r.d(e,"e",function(){return S}),r.d(e,"q",function(){return w});var n=r(3),a=r.n(n),o=(r(30),r(2)),i={TODAY:"today",THIS_WEEK:"this-week",THIS_MONTH:"this-month",CUSTOM:"custom"},c={LOCAL_TO_SERVER:"LOCAL_TO_SERVER",SERVER_TO_LOCAL:"SERVER_TO_LOCAL"},u={TODAY:Object(o.__)("Today","woocommerce-bookings-availability"),THIS_WEEK:Object(o.__)("This week","woocommerce-bookings-availability"),THIS_MONTH:Object(o.__)("This month","woocommerce-bookings-availability")},s=[{value:i.TODAY,label:u.TODAY},{value:i.THIS_WEEK,label:u.THIS_WEEK},{value:i.THIS_MONTH,label:u.THIS_MONTH}],l=[{value:i.THIS_WEEK,label:u.THIS_WEEK},{value:i.THIS_MONTH,label:u.THIS_MONTH}],d="YYYY-MM-DD[T]HH:mm:ss";function f(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=a()().startOf("day").toDate(),o=a()().startOf("day").toDate(),c=1;if(i.THIS_MONTH===t){var u=new Date;n.setMonth(u.getMonth()+e),n.setDate(r),o=a()(n).endOf("month").toDate()}var s=n;if(i.THIS_WEEK===t){c=7;var l=parseInt(wc_bookings_availability_args.start_of_week,10),d=a()().day(c*e+l).startOf("day");n<d&&(n=d.toDate()),o=a()(n).endOf("week").toDate(),s=a()(n).startOf("week").toDate()}if(i.TODAY===t){var f=c*e,b=c*(e+1)-1;n.setDate(n.getDate()+f),o.setDate(o.getDate()+b)}return{minDisplayDate:s,minDate:n,maxDate:o}}function b(t){return i.CUSTOM===t}function m(t){var e=f(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),r=e.minDisplayDate,n=e.minDate,o=e.maxDate;return i.THIS_MONTH===t?a()(n).format("MMMM YYYY"):n.getTime()===o.getTime()?a()(n).format("MMM DD, YYYY"):a()(r).format("MMM DD - ")+a()(o).format("MMM DD, YYYY")}function _(t){switch(t){case i.TODAY:return u.TODAY;case i.THIS_MONTH:return u.THIS_MONTH;case i.THIS_WEEK:default:return u.THIS_WEEK}}function v(t){var e=f(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1);return y(e.minDate,e.maxDate)}function y(t,e){return{minDate:a()(t).format(d),maxDate:a()(e).endOf("day").format(d)}}function g(t){return a()().day(t).format("ddd")}function p(t,e){switch(t){case i.THIS_WEEK:return function(t){var e=a()(new Date).add(7*t,"day"),r=e.isoWeekday(),n=parseInt(wc_bookings_availability_args.start_of_week,10),o=0===n?7:n,i=null;i=r>o?a()(e).subtract(r-o,"day"):r<o?a()(e).subtract(7-(o-r),"day"):e;var c=a()(i).add(6,"day");return{minDate:i.startOf("day"),maxDate:c.endOf("day")}}(e);case i.THIS_MONTH:default:return function(t){var e=a()(new Date).add(t,"month"),r=parseInt(wc_bookings_availability_args.start_of_week,10),n=0===r?7:r,o=e.startOf("month"),i=(7+(o.isoWeekday()-n)%7)%7,c=a()(o).subtract(i,"day"),u=e.endOf("month"),s=(7+(u.isoWeekday()-n)%7)%7,l=a()(u).add(6-s,"day");return{minDate:c.startOf("day"),maxDate:l.endOf("day"),currentMonth:e}}(e)}}function O(t){return a()(t).format("dddd, MMMM DD")}function h(t,e){var r,n=t.duration,i=t.durationUnit,c=a()(e),u=a()(e).add(n,i),s=c.format("Do"),l=c.format("MMMM"),d=u.format("Do"),f=u.format("MMMM");switch(i){case"minute":r="".concat(c.format("h:mma"),"-").concat(u.format("h:mma")," (").concat(D(e),")");break;case"hour":r="".concat(c.format("ha"),"-").concat(u.format("ha")," (").concat(D(e),")");break;case"night":case"day":var b=Object(o.sprintf)(Object(o._n)("%d ".concat(i),"%d ".concat(i,"s"),n*t.min_duration,"woocommerce-bookings-availability"),n*t.min_duration);if("customer"===t.duration_type&&t.min_duration!==t.max_duration){b=Object(o.sprintf)(Object(o.__)("%d-%d ".concat(i,"s"),"woocommerce-bookings-availability"),n*t.min_duration,n*t.max_duration),r="".concat(b);break}r=1===n?"".concat(b):l===f?"".concat(b,", ").concat(l," ").concat(s," - ").concat(d," "):"".concat(b,", ").concat(l," ").concat(s," - ").concat(f," ").concat(d," ");break;case"month":var m=Object(o.sprintf)(Object(o._n)("%d month","%d months",n,"woocommerce-bookings-availability"),n),_=c.startOf("month"),v=u.endOf("month");r=1===n?"".concat(m,", ").concat(_.format("MMMM D")," - ").concat(v.format("D")):"".concat(m,", ").concat(_.format("MMMM D")," - ").concat(v.format("MMMM D"))}return r}function T(t){switch(t){case i.THIS_WEEK:return Object(o.__)("No available times this week.","woocommerce-bookings-availability");case i.THIS_MONTH:return Object(o.__)("No available times this month.","woocommerce-bookings-availability");case i.TODAY:default:return Object(o.__)("No available times this day.","woocommerce-bookings-availability")}}function E(t){switch(t){case i.THIS_WEEK:return Object(o.__)("We weren't able to load times for this week.","woocommerce-bookings-availability");case i.THIS_MONTH:return Object(o.__)("We weren't able to load times for this month.","woocommerce-bookings-availability");case i.TODAY:default:return Object(o.__)("We weren't able to load times for this day.","woocommerce-bookings-availability")}}function S(t,e){var r=function(t){if(!wc_bookings_availability_args.timezone_conversion)return 0;var e=a()(t,d),r=e.utcOffset();e.tz(wc_bookings_availability_args.server_timezone);var n=e.utcOffset();return(r-n)/60}(t),n=a.a.tz(t,d,wc_bookings_availability_args.server_timezone);switch(e){case c.SERVER_TO_LOCAL:n.add(r,"hours");break;case c.LOCAL_TO_SERVER:n.subtract(r,"hours");break;default:throw"Invalid convertDirection option."}return n}function w(t,e){return wc_bookings_availability_args.timezone_conversion?S(t,e).format(d):t}function D(t){return wc_bookings_availability_args.timezone_conversion?a.a.tz(t,d,a.a.tz.guess()).format("z"):a.a.tz(t,d,wc_bookings_availability_args.server_timezone).format("z")}},80:function(t,e,r){t.exports=r(81)},81:function(t,e,r){"use strict";r.r(e);var n=r(15),a=r.n(n),o=r(19);var i={setAvailability:function(t,e,r){return{type:"SET_AVAILABILITY",availability:t,count:e,query:r||{}}},setAvailabilityError:function(t){return{type:"SET_AVAILABILITY_ERROR",query:t||{}}},fetchFromAPI:function(t){return{type:"FETCH_FROM_API",path:t.path}},nextAvailabilityPage:function(t){return{type:"NEXT_AVAILABILITY_PAGE",query:t||{}}}},c=r(6),u=r.n(c),s=r(24),l=r.n(s),d=r(13),f="ERROR";function b(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return JSON.stringify(t,Object.keys(t).sort())}(Object(d.omit)(t,["page"]))}var m={};var _=r(7),v=r(17),y=r(26);function g(t){return t.map(function(t){return t.productId=t.product_id,t.durationUnit=t.duration_unit,delete t.product_id,delete t.duration_unit,t.serverDate=t.date,t.date=Object(_.q)(t.date,_.a.SERVER_TO_LOCAL),t})}var p={getAvailability:regeneratorRuntime.mark(function t(e){var r,n,a,o,c,u,s,l,f,b,m,p,O,h;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.minDate,n=e.maxDate,a=e.page,o=e.productIds,c=e.categoryIds,u=e.resourceIds,s=e.pageSize,l=void 0===s?v.a:s,f={product_ids:o,category_ids:c,resource_ids:u,min_date:r?encodeURIComponent(Object(_.q)(r,_.a.LOCAL_TO_SERVER)):r,max_date:n?encodeURIComponent(Object(_.q)(n,_.a.LOCAL_TO_SERVER)):n,page:a,limit:l,get_past_times:!0},b=Object(y.addQueryArgs)("/wc-bookings/v1/products/slots",Object(d.pickBy)(f,d.identity)),t.prev=3,t.next=6,i.fetchFromAPI({path:b});case 6:return m=t.sent,p=m.records,O=m.count,h=g(p),t.abrupt("return",i.setAvailability(h,O,e));case 12:return t.prev=12,t.t0=t.catch(3),t.abrupt("return",i.setAvailabilityError(e));case 15:case"end":return t.stop()}},t,this,[[3,12]])})};function O(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(d.get)(t,["availability",b(e),"records"],[])}var h={getAvailability:O,getPage:function(t,e){return Object(d.get)(t,["availability",b(e),"page"],1)},getAvailabilityTotalRecords:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(d.get)(t,["availability",b(e),"count"],[])},isGetAvailabilityRequesting:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return Object(o.select)("core/data").isResolving("woocommerce-bookings-availability","getAvailability",r)},isGetAvailabilityError:function(t,e){return f===O(t,e)}},T=r(20),E=r.n(T),S={actions:i,reducer:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,e=arguments.length>1?arguments[1]:void 0,r=b(e.query),n=Object(d.get)(t,[r],{}),a=n.records,o=n.count,i=n.page;switch(e.type){case"SET_AVAILABILITY":var c=a||[];return Object(d.merge)({},t,u()({},r,{records:[].concat(l()(c),l()(e.availability)),count:e.count,page:i||1}));case"SET_AVAILABILITY_ERROR":return Object(d.merge)({},t,u()({},r,f));case"NEXT_AVAILABILITY_PAGE":var s=(i||1)+1;return Object(d.merge)({},t,u()({},r,{records:a,count:o,page:s}))}return t},resolvers:p,selectors:h,controls:{FETCH_FROM_API:function(t){return E()({path:t.path})}}},w={setProducts:function(t,e,r){return{type:"SET_PRODUCTS",products:t,count:e,query:r||{}}},setProductsError:function(t){return{type:"SET_PRODUCTS_ERROR",query:t||{}}},fetchProductsFromAPI:function(t){return{type:"FETCH_PRODUCTS_FROM_API",path:t.path}}},D={};function R(t){return Object(d.reduce)(t,function(t,e){var r=e.id;return delete e.id,e.durationUnit=e.duration_unit,delete e.duration_unit,t[r]=e,t},{})}var A={getProducts:regeneratorRuntime.mark(function t(e){var r,n,a,o,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=(e=e||{}).productIds,n={include:void 0===r?"":r,per_page:-1,_locale:"user"},a=Object(y.addQueryArgs)("/wc-bookings/v1/products",Object(d.pickBy)(n,d.identity)),t.prev=4,t.next=7,w.fetchProductsFromAPI({path:a});case 7:return o=t.sent,i=R(o),t.abrupt("return",w.setProducts(i,o.length,e));case 12:return t.prev=12,t.t0=t.catch(4),t.abrupt("return",w.setProductsError(e));case 15:case"end":return t.stop()}},t,this,[[4,12]])})};function I(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(d.get)(t,["products",b(e),"records"],[])}var k={actions:w,reducer:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,e=arguments.length>1?arguments[1]:void 0,r=b(e.query);switch(e.type){case"SET_PRODUCTS":return Object(d.merge)({},t,u()({},r,{records:e.products,count:e.count}));case"SET_PRODUCTS_ERROR":return Object(d.merge)({},t,u()({},r,f))}return t},resolvers:A,selectors:{getProducts:I,isGetProductsRequesting:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return Object(o.select)("core/data").isResolving("woocommerce-bookings-availability","getProducts",r)},isGetProductsError:function(t,e){return f===I(t,e)}},controls:{FETCH_PRODUCTS_FROM_API:function(t){return E()({path:t.path})}}};Object(o.use)(o.plugins.controls),function(t,e){(e=e.slice()).reverse();var r=t.dispatch;e.forEach(function(e){return r=e(t)(r)}),Object.assign(t,{dispatch:r})}(Object(o.registerStore)("woocommerce-bookings-availability",{reducer:Object(o.combineReducers)({availability:S.reducer,products:k.reducer}),actions:a()({},S.actions,k.actions),selectors:a()({},S.selectors,k.selectors),resolvers:a()({},S.resolvers,k.resolvers),controls:a()({},S.controls,k.controls)}),[function(t){var e=t.getState;return function(t){return function(r){return"function"==typeof r?r(e):t(r)}}}])}});
//# sourceMappingURL=bookings-availability-common.js.map